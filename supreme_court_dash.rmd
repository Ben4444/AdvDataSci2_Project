---
title: "Supreme Court Decisions"
output: 
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: scroll
    theme: spacelab
runtime: shiny
---
```{r setup, include=FALSE}
rsconnect::setAccountInfo(name='jhubiostatistics',
                          token='41969E2AC0F047B42111176450B2ADB8',
                          secret='vzjG1Ab7kdLIzR7mFTQW3uJdJnzhcsv5NBcanzXs')

library(flexdashboard)
library(shiny)
library(ggplot2)
library(lubridate)
library(RColorBrewer)
library(magrittr)
library(dplyr)

dat <- readRDS("full.rds")
dat_sub <- readRDS("full_subset.rds")
dat_sub_pr <- readRDS("full_sub_pr.rds")
dat$decided<- as.Date(dat$decided,format="%B %d, %Y")
dat$datenom<- as.Date(dat$datenom,format="%m/%d/%Y")
topic_list <- unique(dat$topic)
justice_list <- unique(dat$name)
party_list <- unique(dat_sub$pres_party)
religion_list <- unique(dat_sub$religion)


#making birthplace list 

for(i in 1:length(dat$birthst)){
if(dat$birthst[i] %in% c(19,21,39,7,29,45,32,38,30,8,20,51)){
  dat$region[i]<- "Northeast"
} else if(dat$birthst[i] %in% c(48,46,17,42,33,40,10,1,24,4,18,9)){
  dat$region[i]<-"Southeast"
}else if(dat$birthst[i] %in% c(35,14,22,13,25,49,23,15,16,27,41,34)){
  dat$region[i]<- "Midwest"
}else if(dat$birthst[i] %in% c(43,36,31,3)){
  dat$region[i]<- "Southwest"
}else if (dat$birthst[i] %in% c(6,50,26,12,47,37,44,28,5,2,11)){
  dat$region[i]<-"West"
}else if(dat$birthst[i] %in% c(52,53,54,55,56,57,58)){
  dat$region[i]<-"International"
}
}
region_list<- unique(dat$region)

#making the socioeconomic status list

for(i in 1:length(dat$famses)){
if(!is.na(dat$famses[i])&dat$famses[i] == 1){
  dat$famses[i]<- "Lower"
}else if (!is.na(dat$famses[i])&dat$famses[i] %in% c(2,3,4)){
  dat$famses[i]<- "Middle"
}else if(!is.na(dat$famses[i])&dat$famses[i] == 5){
  dat$famses[i]<-"Upper"
}else{
  dat$famses[i]<- "Unknown"
}
}

ses_list<-unique(dat$famses)
```

By Topic
=======================================================================

Column {.sidebar}
-----------------------------------------------------------------------

#### Set Parameters
```{r}
selectInput("topic", label = "Topic:",
            choices = topic_list, selected = NULL, multiple = T)
```

Row
-----------------------------------------------------------------------

```{r}
renderPlot({
  ggplot(dat) + 
    geom_bar(aes(x = reorder(topic, -table(topic)[topic]))) + 
    theme(axis.text.x = element_text(angle = 90, hjust = 0.95, vjust = 0.2), axis.text = element_text(size = 11), 
          axis.title = element_text(size = 15)) + 
    scale_y_continuous(expand = c(0,5)) + 
    labs(x = "Topic", y = "No. Cases")
})
```


Row
-----------------------------------------------------------------------

```{r}
renderPlot({
  req(!is.null(input$topic))
  
  dat_subset <- dat[dat$topic %in% input$topic, c("name","topic")]
  melted_df <- as.data.frame(table(dat_subset))
  
  palette = scale_fill_brewer(palette = "Set1")
  if(length(unique(dat_subset$name)) > 9){ 
       palette = scale_fill_manual(values = colorRampPalette(colors=brewer.pal(9, "Set1"))(length(unique(dat_subset$name))))
  }
  
for(j in input$topic){
  melted_df[melted_df$topic == j,"percent"] <- melted_df[melted_df$topic == j,"Freq"]*100 / sum(melted_df[melted_df$topic == j,"Freq"])
}
  
  ggplot(melted_df) + 
    geom_col(aes(x = reorder(topic, -table(topic)[topic]), y = percent, fill = name)) + 
    theme(axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 11), 
          axis.title = element_text(size = 15), legend.position = "bottom") + 
    scale_y_continuous(limits = c(0, NA),expand = c(0,0)) + 
    labs(x = "Topic", y = "Percent of Cases", fill = "Justice\nDelivering\nOpinion") +
    palette
})
```


By Justice
================================================================

Column {.sidebar}
----------------------------------------------------------------

#### Set Parameters
```{r}
selectInput("justice", label = "Justice:",
            choices = justice_list, selected = NULL, multiple = T)
```

Row
-----------------------------------------------------------------------

```{r}
renderPlot({
  ggplot(dat) + 
    geom_bar(aes(x = reorder(name, datenom))) + 
    theme(axis.text.x = element_text(angle = 90, hjust = 0.95, vjust = 0.2), axis.text = element_text(size = 11), 
          axis.title = element_text(size = 13)) + 
    scale_y_continuous(expand = c(0,5)) + 
    labs(x = "Justice", y = "No. Times Justice Delivered Opinion",
         caption = "Justices ordered by date of nomination (or recess appointment), through 1993.")
})
```

Row
-----------------------------------------------------------------------

```{r}
renderPlot({
  req(!is.null(input$justice))
  
  palette = scale_fill_brewer(palette = "Set1")
  if(length(input$justice) > 9){ 
       palette = scale_fill_manual(values = colorRampPalette(colors=brewer.pal(9, "Set1"))(length(input$justice)))
  }
  
  dat_subset <- dat[dat$name %in% input$justice, c("name", "topic")]
  melted_df <- as.data.frame(table(dat_subset))
  ggplot(melted_df) + 
    geom_col(aes(x = topic, y = Freq, fill = name), position = "dodge") + 
    theme(axis.text.x = element_text(angle = 45, hjust = 1), axis.text = element_text(size = 11), 
          legend.position = "bottom", panel.background = element_blank(), axis.line = element_line(), axis.title = element_text(size = 15),
          panel.grid.major.y = element_line(color = "grey90")) +
    scale_y_continuous(limits = c(NA,NA),expand = c(0,0)) +
    geom_text(aes(x = 1,y=Freq + 1, label="")) +
    labs(x = "Topic", y = "No. Cases", fill = "Justice Delivering Opinion:") +
    palette
})
```

By Political Party and Religion
================================================================

Column {.sidebar}
----------------------------------------------------------------

#### Set Parameters
```{r}
selectInput("party", label = "Nominating President's Party:",
            choices = party_list, selected = NULL, multiple = T)

selectInput("religion", label = "Justice's Religion:",
            choices = religion_list, selected = NULL, multiple = T)
```

Row
-----------------------------------------------------------------------

```{r}
dat_sub$Party <- dat_sub$pres_party
renderPlot({
  ggplot(dat_sub) + 
    geom_bar(aes(x = name, fill = religion, alpha = Party)) + 
    theme(axis.text.x = element_text(angle = 90, hjust = 0.95, vjust = 0.2), axis.text = element_text(size = 11), 
          axis.title = element_text(size = 15), legend.position = "top") + 
    scale_y_continuous(expand = c(0,5)) + 
    scale_alpha_manual(values=c(0.4, 1)) +
    guides(fill = guide_legend(title = "Justice's Religion")) + 
    labs(x = "Justice", y = "No. Times Justice Delivered Opinion",
         caption = "Justices restricted to those nominated by Republican or Democratic presidents in the modern political era (1933 - 2015).")
})
```

Row
-----------------------------------------------------------------------

```{r}
renderPlot({
  req(!is.null(input$party))
  
  palette = scale_fill_brewer(palette = "Set2")
  
  dat_subset <- dat_sub[dat_sub$pres_party %in% input$party, c("pres_party", "topic")]
  melted_df <- as.data.frame(table(dat_subset))
  ggplot(melted_df) + 
    geom_col(aes(x = topic, y = Freq, fill = pres_party), position = "dodge") + 
    theme(axis.text.x = element_text(angle = 90, hjust = 0.95, vjust = 0.2), axis.text = element_text(size = 11),
          legend.position = "bottom", panel.background = element_blank(), axis.line = element_line(), axis.title = element_text(size = 15),
          panel.grid.major.y = element_line(color = "grey90")) +
    scale_y_continuous(limits = c(NA,NA), expand = c(0,0)) +
    geom_text(aes(x = 1, y = Freq + 1, label="")) +
    labs(x = "Topic", y = "No. Cases", fill = "Nominating President's Party:") +
    palette
})
```

Row
-----------------------------------------------------------------------

```{r}
renderPlot({
  req(!is.null(input$religion))
  
  palette = scale_fill_brewer(palette = "Set2")
  if(length(input$religion) > 9){ 
       palette = scale_fill_manual(values = colorRampPalette(colors=brewer.pal(9, "Set1"))(length(input$religion)))
  }
  
  dat_subset <- dat_sub[dat_sub$religion %in% input$religion, c("religion", "topic")]
  melted_df <- as.data.frame(table(dat_subset))
  ggplot(melted_df) + 
    geom_col(aes(x = topic, y = Freq, fill = religion), position = "dodge") + 
    theme(axis.text.x = element_text(angle = 90, hjust = 0.95, vjust = 0.2), axis.text = element_text(size = 11),
          legend.position = "bottom", panel.background = element_blank(), axis.line = element_line(), axis.title = element_text(size = 15),
          panel.grid.major.y = element_line(color = "grey90")) +
    scale_y_continuous(limits = c(NA,NA), expand = c(0,0)) +
    geom_text(aes(x = 1, y = Freq + 1, label="")) +
    labs(x = "Topic", y = "No. Cases", fill = "Justice's Religion:") +
    palette
})
```
